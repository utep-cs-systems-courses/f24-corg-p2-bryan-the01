#include <msp430.h>
#include "switches.h"
#include "led.h"
#include "alarm.h" 

void switch_interrupt_handler() {
  char p1val = switch_update_interrupt_sense();
  switch_state_down = (p1val & SW1) ? 0 : 1;  // 0 when SW1 is up
  switch_state_changed = 1;

  if (switch_state_down) {
    if (alarm_state == 0) {
      alarm_state = 1;  // Turn on alarm
      alarm_init();      // Initialize the alarm system
    } else {
      alarm_state = 0;  // Turn off alarm
      red_led_off();    // Turn off the red LED
      buzzer_set_period(0);  // Stop the buzzer
    }
  }

  led_update(); // Update the LEDs
}
